FROM node:22-bookworm-slim

WORKDIR /workspace

ENV NG_CLI_ANALYTICS=false \
    npm_config_audit=false \
    npm_config_fund=false

# Install app dependencies first to leverage docker layer cache
COPY package*.json ./
# Use npm install to generate lockfile on first build; switch to npm ci later if desired
RUN npm install

# Copy source
COPY . .

# Expose Angular dev server port
EXPOSE 4200

# Enable polling for better reliability on Docker for Windows/WSL volume mounts
ENV CHOKIDAR_USEPOLLING=true \
    WATCHPACK_POLLING=true \
    BROWSER=none

CMD ["npm", "start", "--", "--host", "0.0.0.0", "--port", "4200"]
